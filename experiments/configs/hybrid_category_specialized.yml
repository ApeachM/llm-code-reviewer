# Category-specialized hybrid: Routes categories to optimal techniques
# logic-errors/api-misuse → Few-shot, semantic-inconsistency → CoT

experiment_id: hybrid_category_specialized
technique_name: hybrid_category_specialized
model_name: deepseek-coder:33b-instruct
dataset_path: experiments/ground_truth/cpp

technique_params:
  # Few-shot config (for logic-errors, api-misuse, edge-case-handling)
  few_shot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Focus on: logic-errors, api-misuse, edge-case-handling

      DO NOT report memory, concurrency, or performance issues (tools handle these).

      Respond with JSON array of issues. Each issue: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    few_shot_examples:
      - id: semantic_001
        code: "for (int i = 0; i <= nums.size(); i++) sum += nums[i];"
        issues:
          - category: logic-errors
            severity: critical
            line: 1
            description: "Off-by-one error: uses <= instead of <"
            reasoning: "Loop allows i to equal size, causing out-of-bounds access."

      - id: semantic_002
        code: "FILE* f = fopen(path, \"r\");\nif (fread(buf, 1, 1024, f) == 0) return false;\nfclose(f);"
        issues:
          - category: api-misuse
            severity: high
            line: 2
            description: "File handle leaked in error path"
            reasoning: "Early return skips fclose()."

      - id: semantic_003
        code: "double avg(const std::vector<double>& v) { return sum(v) / v.size(); }"
        issues:
          - category: edge-case-handling
            severity: critical
            line: 1
            description: "Division by zero if empty"
            reasoning: "No empty check before division."

      - id: semantic_004
        code: "if (data.empty()) return; for (auto x : data) process(x);"
        issues: []

    temperature: 0.1
    max_tokens: 2000

  # Chain-of-thought config (for semantic-inconsistency, code-intent-mismatch)
  cot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Use step-by-step reasoning.
      Focus on: semantic-inconsistency, code-intent-mismatch

      First, show your reasoning in <thinking>...</thinking> tags.
      Then, provide your analysis as JSON array.

      Respond with JSON array: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    temperature: 0.1
    max_tokens: 3000

seed: 42
