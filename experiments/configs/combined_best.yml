# Combined technique: few-shot + chain-of-thought + self-critique
# Research hypothesis: Highest accuracy by combining best techniques

experiment_id: combined_best_techniques
technique_name: combined_best
model_name: deepseek-coder:33b-instruct
dataset_path: experiments/ground_truth/cpp

technique_params:
  # Few-shot examples (3 high-quality examples)
  few_shot_examples:
    - id: example_001
      code: "int* ptr = new int(10);\nreturn 0;"
      issues:
        - category: memory-safety
          severity: critical
          line: 1
          description: "Memory leak"
          reasoning: "Allocated but never deleted."

    - id: example_015
      code: "int counter = 0;\nvoid inc() { counter++; }\nstd::thread t1(inc);\nstd::thread t2(inc);"
      issues:
        - category: concurrency
          severity: critical
          line: 2
          description: "Data race"
          reasoning: "Unsynchronized access from multiple threads."

    - id: example_017
      code: "std::unique_ptr<int> ptr = std::make_unique<int>(42);\nreturn 0;"
      issues: []

  # Pass 1: Chain-of-thought analysis with few-shot examples
  pass1_prompt: |
    You are an expert C++ code reviewer. Use these examples as reference, then analyze the target code.

    EXAMPLES:
    {FEW_SHOT_EXAMPLES}

    TARGET CODE:
    {CODE}

    Think step-by-step:
    1. What is this code doing?
    2. What could go wrong?
    3. What issues are present?

    <thinking>
    [Your reasoning here]
    </thinking>

    JSON response: [{category, severity, line, description, reasoning}]

  # Pass 2: Self-critique
  pass2_prompt: |
    Review your findings critically. For each issue:
    1. Is this truly an issue?
    2. Confidence level (0.0-1.0)?

    Previous issues:
    {PASS1_ISSUES}

    Respond with revised JSON array with "confidence" field. Remove false positives.

  confidence_threshold: 0.7
  temperature: 0.1
  max_tokens: 3000

seed: 42
