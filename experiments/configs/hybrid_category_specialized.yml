# Category-specialized hybrid: Routes categories to optimal techniques
# Phase 4: Memory/security → Few-shot, Modern-cpp/performance → CoT

experiment_id: hybrid_category_specialized
technique_name: hybrid_category_specialized
model_name: deepseek-coder:33b-instruct
dataset_path: experiments/ground_truth/cpp

technique_params:
  # Few-shot config (for memory-safety, security, concurrency)
  few_shot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Focus on: memory-safety, security, concurrency

      Respond with JSON array of issues. Each issue: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    few_shot_examples:
      - id: example_001
        code: "int* ptr = new int(10);\n*ptr = 42;\nreturn 0;"
        issues:
          - category: memory-safety
            severity: critical
            line: 1
            description: "Memory leak - pointer never deleted"
            reasoning: "Allocated with 'new' but no corresponding 'delete'."

      - id: example_002
        code: "int* ptr = new int(100);\ndelete ptr;\nstd::cout << *ptr << std::endl;"
        issues:
          - category: memory-safety
            severity: critical
            line: 3
            description: "Use-after-free"
            reasoning: "Pointer deleted on line 2, then dereferenced on line 3. Undefined behavior."

      - id: example_015
        code: "int counter = 0;\nvoid inc() { for(int i=0; i<1000; i++) counter++; }\nstd::thread t1(inc);\nstd::thread t2(inc);"
        issues:
          - category: concurrency
            severity: critical
            line: 2
            description: "Data race on shared variable"
            reasoning: "Multiple threads access 'counter' without synchronization. Use mutex or atomic."

      - id: security_example
        code: "std::string query = \"SELECT * FROM users WHERE id=\" + user_input;"
        issues:
          - category: security
            severity: critical
            line: 1
            description: "SQL injection vulnerability"
            reasoning: "User input concatenated directly into SQL query. Use prepared statements."

      - id: example_017
        code: "std::unique_ptr<int> ptr = std::make_unique<int>(42);\nreturn 0;"
        issues: []

    temperature: 0.1
    max_tokens: 2000

  # Chain-of-thought config (for modern-cpp, performance)
  cot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Use step-by-step reasoning.
      Focus on: modern-cpp, performance

      First, show your reasoning in <thinking>...</thinking> tags.
      Then, provide your analysis as JSON array.

      Respond with JSON array: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    temperature: 0.1
    max_tokens: 3000

seed: 42
