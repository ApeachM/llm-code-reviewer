# Hybrid technique: Few-shot + Chain-of-thought for semantic issues
# Best accuracy but 4x slower - use for critical PRs

experiment_id: hybrid_technique
technique_name: hybrid
model_name: deepseek-coder:33b-instruct
dataset_path: experiments/ground_truth/cpp

technique_params:
  # Sub-config for few-shot pass
  few_shot_config:
    system_prompt: |
      You are an expert C++ code reviewer specializing in SEMANTIC issues.

      DO NOT report memory, concurrency, or performance issues (tools handle these).
      Focus ONLY on semantic issues requiring understanding of code INTENT.

      Categories: logic-errors, api-misuse, semantic-inconsistency, edge-case-handling, code-intent-mismatch
      Respond with JSON array: [{category, severity, line, description, reasoning}]
      If no issues, respond with [].

    few_shot_examples:
      - id: semantic_001
        code: "std::vector<int> nums = {1,2,3};\nfor (int i = 0; i <= nums.size(); i++) sum += nums[i];"
        issues:
          - category: logic-errors
            severity: critical
            line: 2
            description: "Off-by-one error: loop uses <= instead of <"
            reasoning: "Allows i to equal size, causing out-of-bounds access."

      - id: semantic_002
        code: "FILE* f = fopen(path, \"r\");\nif (fread(buf, 1, 1024, f) == 0) return false;\nfclose(f);"
        issues:
          - category: api-misuse
            severity: high
            line: 2
            description: "File handle leaked in error path"
            reasoning: "Early return skips fclose(). File descriptor leaked."

      - id: semantic_003
        code: "double getPrice() { discountApplied_ = true; return price_ * 0.9; }"
        issues:
          - category: semantic-inconsistency
            severity: medium
            line: 1
            description: "Getter has side effect"
            reasoning: "'get...' implies read-only but modifies state."

      - id: semantic_004
        code: "double avg(const std::vector<double>& v) { return sum(v) / v.size(); }"
        issues:
          - category: edge-case-handling
            severity: critical
            line: 1
            description: "Division by zero if empty"
            reasoning: "No empty check. v.size() can be 0."

      - id: semantic_005
        code: "void process(const std::vector<int>& d) { if (d.empty()) return; for (auto x : d) work(x); }"
        issues: []

    temperature: 0.1
    max_tokens: 2000

  # Sub-config for chain-of-thought pass
  cot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Use step-by-step reasoning to find SEMANTIC issues.

      First, show your reasoning in <thinking>...</thinking> tags.
      Then, provide JSON array of issues.

      Focus on: semantic-inconsistency, code-intent-mismatch (complex categories)

      Respond with JSON array: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    temperature: 0.1
    max_tokens: 3000

  # Categories to use chain-of-thought for (complex semantic issues)
  cot_categories:
    - semantic-inconsistency
    - code-intent-mismatch

  confidence_threshold: 0.6

seed: 42
