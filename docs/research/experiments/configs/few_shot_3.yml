# Few-shot learning with 3 semantic examples
# Research hypothesis: +30-40% accuracy improvement over zero-shot

experiment_id: few_shot_3_examples
technique_name: few_shot_3
model_name: deepseek-coder:33b-instruct
dataset_path: docs/research/experiments/ground_truth/cpp

technique_params:
  system_prompt: |
    You are an expert C++ code reviewer specializing in SEMANTIC issues.

    DO NOT report memory leaks, data races, or performance issues (static/dynamic tools handle these).
    Focus ONLY on logic errors, API misuse, and semantic inconsistencies.

    Categories: logic-errors, api-misuse, semantic-inconsistency, edge-case-handling, code-intent-mismatch
    Respond with JSON array of issues: [{category, severity, line, description, reasoning}]
    If no issues, respond with [].

  few_shot_examples:
    - id: semantic_001
      description: "Off-by-one error in loop"
      code: |
        std::vector<int> nums = {1, 2, 3, 4, 5};
        int sum = 0;
        for (int i = 0; i <= nums.size(); i++) {
            sum += nums[i];
        }
        return sum;
      issues:
        - category: logic-errors
          severity: critical
          line: 3
          description: "Off-by-one error: loop uses <= instead of <"
          reasoning: "Loop condition i <= nums.size() allows i to equal 5 (size), causing out-of-bounds access at nums[5]. Should use i < nums.size()."

    - id: semantic_002
      description: "Resource leak in error path"
      code: |
        bool processFile(const std::string& path) {
            FILE* f = fopen(path.c_str(), "r");
            if (!f) return false;
            char buffer[1024];
            if (fread(buffer, 1, 1024, f) == 0) {
                return false;  // Error: file not closed!
            }
            fclose(f);
            return true;
        }
      issues:
        - category: api-misuse
          severity: high
          line: 6
          description: "File handle leaked in error path"
          reasoning: "fopen() succeeds but early return on line 6 skips fclose(). File descriptor leaked on read error."

    - id: semantic_005
      description: "Clean code - no issues"
      code: |
        void processData(const std::vector<int>& data) {
            if (data.empty()) {
                return;
            }
            for (size_t i = 0; i < data.size(); ++i) {
                process(data[i]);
            }
        }
      issues: []

  temperature: 0.1
  max_tokens: 2000

seed: 42
