# Hybrid technique: Few-shot-5 + Chain-of-thought for specific categories
# Phase 4: Combines strengths of both techniques

experiment_id: hybrid_technique
technique_name: hybrid
model_name: deepseek-coder:33b-instruct
dataset_path: experiments/ground_truth/cpp

technique_params:
  # Sub-config for few-shot pass
  few_shot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Analyze code for issues in these categories:
      memory-safety, modern-cpp, performance, security, concurrency

      Respond with JSON array of issues. Each issue: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    few_shot_examples:
      - id: example_001
        code: "int* ptr = new int(10);\n*ptr = 42;\nreturn 0;"
        issues:
          - category: memory-safety
            severity: critical
            line: 1
            description: "Memory leak - pointer never deleted"
            reasoning: "Allocated with 'new' but no corresponding 'delete'."

      - id: example_002
        code: "int* ptr = new int(100);\ndelete ptr;\nstd::cout << *ptr << std::endl;"
        issues:
          - category: memory-safety
            severity: critical
            line: 3
            description: "Use-after-free"
            reasoning: "Pointer deleted on line 2, then dereferenced on line 3. Undefined behavior."

      - id: example_006
        code: "Widget* w = new Widget(42);\nstd::cout << w->value;\ndelete w;"
        issues:
          - category: modern-cpp
            severity: medium
            line: 1
            description: "Use std::unique_ptr instead of raw pointer"
            reasoning: "Manual memory management. Use std::unique_ptr for automatic cleanup."

      - id: example_015
        code: "int counter = 0;\nvoid inc() { for(int i=0; i<1000; i++) counter++; }\nstd::thread t1(inc);\nstd::thread t2(inc);"
        issues:
          - category: concurrency
            severity: critical
            line: 2
            description: "Data race on shared variable"
            reasoning: "Multiple threads access 'counter' without synchronization. Use mutex or atomic."

      - id: example_017
        code: "std::unique_ptr<int> ptr = std::make_unique<int>(42);\nreturn 0;"
        issues: []

    temperature: 0.1
    max_tokens: 2000

  # Sub-config for chain-of-thought pass
  cot_config:
    system_prompt: |
      You are an expert C++ code reviewer. Use step-by-step reasoning to find issues.

      First, show your reasoning in <thinking>...</thinking> tags.
      Then, provide your analysis as JSON array of issues.

      Focus on: modern-cpp, performance

      Respond with JSON array: {category, severity, line, description, reasoning}
      If no issues, respond with [].

    temperature: 0.1
    max_tokens: 3000

  # Categories to use chain-of-thought for (based on Phase 2 results)
  cot_categories:
    - modern-cpp
    - performance

  # Confidence threshold for filtering issues
  confidence_threshold: 0.6

seed: 42
